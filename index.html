<script>
function resolverSistema() {
    const inputs = document.querySelectorAll('.eq-input');
    const esDecimal = document.getElementById('modoDecimal').checked;
    const out = document.getElementById('resultado');

    let eqs = [];
    inputs.forEach(i => {
        if (i.value.trim()) {
            // Pasar todo a forma = 0
            let partes = i.value.split('=');
            if (partes.length !== 2) throw "Formato incorrecto";
            eqs.push(`(${partes[0]})-(${partes[1]})`);
        }
    });

    if (eqs.length < 2) {
        out.innerHTML = "Introduce al menos 2 ecuaciones.";
        return;
    }

    try {
        // Detectar variables
        let vars = [];
        let texto = eqs.join('');
        if (texto.includes('x')) vars.push('x');
        if (texto.includes('y')) vars.push('y');
        if (texto.includes('z')) vars.push('z');

        // Resolver sistema
        let sol = nerdamer.solve(eqs, vars);

        if (!sol || Object.keys(sol).length === 0) {
            out.innerHTML = "<span style='color:orange'>Sin soluci√≥n o sistema indeterminado</span>";
            return;
        }

        let resFinal = [];

        vars.forEach(v => {
            let val = sol[v][0];
            if (esDecimal) {
                let num = nerdamer(val).evaluate().text();
                resFinal.push(`${v} \\approx ${parseFloat(num).toFixed(4)}`);
            } else {
                resFinal.push(`${v} = ${nerdamer(val).toTeX()}`);
            }
        });

        out.innerHTML = `$$ \\{ ${resFinal.join(', \\; ')} \\} $$`;
        MathJax.typesetPromise([out]);

    } catch (e) {
        console.error(e);
        out.innerHTML = "<span style='color:red'>Error: Revisa la escritura del sistema</span>";
    }
}
</script>
